<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>src/routes/reviseUserProfile.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PowerIntegralExercise.html">PowerIntegralExercise</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TrigonometricIntegralExercise.html">TrigonometricIntegralExercise</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VektorAdditionExercise.html">VektorAdditionExercise</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VektorMultiplicationExercise.html">VektorMultiplicationExercise</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="VektorSubtractionExercise.html">VektorSubtractionExercise</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addButtonToExerciseForm">addButtonToExerciseForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addExerciseHeader">addExerciseHeader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addExerciseInputField">addExerciseInputField</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addExercisesToExerciseForm">addExercisesToExerciseForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addExerciseText">addExerciseText</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addExerciseVars">addExerciseVars</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addPoints">addPoints</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addSingleExerciseToExerciseForm">addSingleExerciseToExerciseForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#buildExercisePage">buildExercisePage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#calcGrade">calcGrade</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#calculateExerciseProfile">calculateExerciseProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#calculateUserProfile">calculateUserProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#calcUserStats">calcUserStats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkAnswer">checkAnswer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkTable">checkTable</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkUserAnswerValue">checkUserAnswerValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#clearDom">clearDom</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#convertExerciseSetToExerciseProfiles">convertExerciseSetToExerciseProfiles</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#convertExerciseToVector">convertExerciseToVector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createExerciseForm">createExerciseForm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createGradeText">createGradeText</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createStatsDivs">createStatsDivs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#errorResponse">errorResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#fetchRequestBody">fetchRequestBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#formatVector">formatVector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateExcerciseSet">generateExcerciseSet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateIntegralExercise">generateIntegralExercise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateRandom2dVector">generateRandom2dVector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateRandom3dVector">generateRandom3dVector</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateResultPage">generateResultPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateVariablesForPowerIntegralExercise">generateVariablesForPowerIntegralExercise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateVariablesForTrigonometricIntergralExercise">generateVariablesForTrigonometricIntergralExercise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateVector3dExercise">generateVector3dExercise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateVectorExercise">generateVectorExercise</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getCheckedExerciseSubject">getCheckedExerciseSubject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getExerciseSetFromServer">getExerciseSetFromServer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getExerciseSubjects">getExerciseSubjects</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getPowerIntegralFacit">getPowerIntegralFacit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getTrigonometricIntegralFacit">getTrigonometricIntegralFacit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getVektorAdditionFacit">getVektorAdditionFacit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getVektorMultiplicationFacit">getVektorMultiplicationFacit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getVektorSubtractionFacit">getVektorSubtractionFacit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#giveFormAction">giveFormAction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleBaseRequest">handleBaseRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleOpgaverRequest">handleOpgaverRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleRequest">handleRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleReviseUserProfilePostRequest">handleReviseUserProfilePostRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#handleReviseUserProfileRequest">handleReviseUserProfileRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isCorrectAnswer">isCorrectAnswer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isUserProfileValidVector">isUserProfileValidVector</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#numOfTasks">numOfTasks</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#randNum">randNum</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#requestBodyExerciseSetIsValid">requestBodyExerciseSetIsValid</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#requestBodyIsValid">requestBodyIsValid</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#requestBodyUserProfileIsValid">requestBodyUserProfileIsValid</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#respondWith">respondWith</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#respondWithNewUserProfile">respondWithNewUserProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#reviseUserProfile">reviseUserProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#scalarMultiplication">scalarMultiplication</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#showQuestionResult">showQuestionResult</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#subjectsStringToArray">subjectsStringToArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#sumVectorArray">sumVectorArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#tryHandleRequest">tryHandleRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateEachExerciseInExerciseSet">validateEachExerciseInExerciseSet</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">src/routes/reviseUserProfile.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { errorResponse } = require('../helper');

const CORRECT_ANSWER_WEIGHT = 0.2;
const WRONG_ANSWER_WEIGHT = 0.7;
const USER_WEIGHT = 0.5;

/**
 * Handles requests to /reviseUserProfile, if the request is a post request handle the request,
 * else if it’s not a request don’t handle it.
 *
 * @param {{}} request
 * @param {{}} response
 */
function handleReviseUserProfileRequest(request, response) {
  if (request.method === 'POST') {
    handleReviseUserProfilePostRequest(request, response);
  } else if (request.method !== 'POST') {
    throw 'bad request';
  }
}

/**
 * Handles a post rquest to /reviseUserProfile, will try fetching request body, then based on the
 * userProfile and exerciseSet in this body calculate a new userProfile, then responde with the new
 * userProfile.
 *
 * @param {{}} request
 * @param {{}} response
 */
async function handleReviseUserProfilePostRequest(request, response) {
  try {
    const { userProfile, exerciseSet } = await fetchRequestBody(request);
    const newUserProfile = reviseUserProfile(exerciseSet, userProfile);
    respondWithNewUserProfile(newUserProfile, response);
  } catch (error) {
    errorResponse(response, '400', `${error}`);
  }
}

/**
 * fetch request body (JSON object).
 *
 * @param {*} request
 * @returns {Promise} Request body.
 */
function fetchRequestBody(request) {
  return new Promise((resolve, reject) => {
    let requestBody = '';
    request.on('data', (chunk) => {
      requestBody += chunk;
    });

    request.on('end', () => {
      try {
        requestBody = JSON.parse(requestBody);

        if (!requestBodyIsValid(requestBody)) {
          throw 'invalid request body';
        }

        resolve(requestBody);
      } catch (error) {
        reject(error);
      }
    });

    request.on('error', (error) => {
      reject(error);
    });
  });
}

/**
 * Checks if requestBody has the correct properties and that the properties are of the correct type.
 *
 * @param {Object} requestBody
 * @returns {boolean} True if the requestBody is valid, else false.
 */
function requestBodyIsValid(requestBody) {
  return requestBodyUserProfileIsValid(requestBody)
    &amp;&amp; requestBodyExerciseSetIsValid(requestBody);
}

/**
 * Checks that requestBody has property userProfile and that the lenght of userProfile is 23. If
 * this is the case check if it's a true vector.
 *
 * @param {Object} requestBody Object to control.
 * @returns {Boolean} True if the userProfile is valid, else false.
 */
function requestBodyUserProfileIsValid(requestBody) {
  let isValidUserProfile;
  if (!(requestBody.hasOwnProperty('userProfile') &amp;&amp; requestBody.userProfile.length === 23)) {
    isValidUserProfile = false;
  } else if (requestBody.hasOwnProperty('userProfile') &amp;&amp; requestBody.userProfile.length === 23) {
    isValidUserProfile = isUserProfileValidVector(requestBody.userProfile);
  }

  return isValidUserProfile;
}

/**
 * Checks that all items in an array are numbers, ie if it's vector.
 *
 * @param {Array} susVector Array to check.
 * @returns {Boolean} True if alle items are numbers, else false.
 */
const isUserProfileValidVector = (susVector) => susVector.every((entry) => typeof entry === 'number');

/**
 * Checks if requestBody contains the property exerciseSet, if it does checks if each exercise in
 * exerciseSet is valid.
 *
 * @param {Object} requestBody
 * @returns True if the requestBody.ExerciseSet is valid, else false.
 */
function requestBodyExerciseSetIsValid(requestBody) {
  let isValidExerciseSet;
  if (!requestBody.hasOwnProperty('exerciseSet')) {
    isValidExerciseSet = false;
  } if (requestBody.hasOwnProperty('exerciseSet')) {
    isValidExerciseSet = validateEachExerciseInExerciseSet(requestBody.exerciseSet);
  }

  return isValidExerciseSet;
}

/**
 * Checks if each exercise in requestBody.ExerciseSet contains the correct properties and that these
 * properties are of the correct type.
 *
 * @param {Object[]} exerciseSet
 * @returns True if the requestBody.ExerciseSet is valid, else false.
 */
function validateEachExerciseInExerciseSet(exerciseSet) {
  return exerciseSet.every((exercise) => exercise.hasOwnProperty('type')
    &amp;&amp; exercise.hasOwnProperty('questionAnswers')
    &amp;&amp; exercise.hasOwnProperty('facit')
    &amp;&amp; typeof exercise.type === 'string'
    &amp;&amp; typeof exercise.questionAnswers === 'string'
    &amp;&amp; typeof exercise.facit === 'string');
}

/**
 * Function to revise the user profile based upon the old profile and an exerciseset
 *
 * @param {object[]} exerciseSet The exercise set to calculate user profile based on
 * @param {number[]} userProfile The vector representing the user profile
 * @return {number[]} A new vector representing the revised user profile
 */
function reviseUserProfile(exerciseSet, userProfile) {
  const exerciseProfiles = convertExerciseSetToExerciseProfiles(exerciseSet);
  const newUserProfile = calculateUserProfile(exerciseProfiles, userProfile);
  return newUserProfile;
}

/**
 * Converts a exerciseSet to an Array of exercises exerciseSet to an array of vectors/arrays called
 * exerciseProfiles.
 *
 * @param {Object[]} exerciseSet
 * @returns {Number[] exerciseProfile vectors.
 */
function convertExerciseSetToExerciseProfiles(exerciseSet) {
  const exerciseProfiles = [];

  exerciseSet.forEach((exercise) => {
    exerciseProfiles.push(calculateExerciseProfile(exercise));
  });

  return exerciseProfiles;
}

/**
 * Calculates a single exerciseProfile vector given an exercise. If the answer is wrong the
 * exerciseProfile is multiplied by 0.2, if the answer is wrong the exerciseProfile is multiplied by
 * 0.7.
 *
 * @param {{}} exercise
 * @returns ExerciseProfile.
 */
function calculateExerciseProfile(exercise) {
  let exerciseProfile = convertExerciseToVector(exercise);

  if (isCorrectAnswer(exercise)) {
    exerciseProfile = scalarMultiplication(CORRECT_ANSWER_WEIGHT, exerciseProfile);
  } else if (!isCorrectAnswer(exercise)) {
    exerciseProfile = scalarMultiplication(WRONG_ANSWER_WEIGHT, exerciseProfile);
  }

  return exerciseProfile;
}
/**
 * Converts and exercise to vector representation.
 *
 * @param {{}} exercise
 * @returns {number[]} Exercise vector.
 */
function convertExerciseToVector(exercise) {
  switch (exercise.type) {
    case 'talOgRegnearter_C':
      return [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'ligninger_C':
      return [0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'funktioner_C':
      return [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'trigonometri_C':
      return [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'geometri_C':
      return [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'sandsynlighed_C':
      return [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'andengradspolynomiumOgLigning_B':
      return [0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'trigonometri_B':
      return [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'funktioner_B':
      return [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'geometri_B':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'differentialregning_B':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'sandsynlighedOgKombinatori_B':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'statistik_B':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'regression_B':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'vektorerI2d_B':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0];
    case 'vektorerI3d_A':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0];
    case 'vektorfunktioner_A':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0];
    case 'trigonometri_A':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0];
    case 'infinitesimalregning_A':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0];
    case 'differentialregning_A':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0];
    case 'integralregning_A':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];
    case 'funktionerAfToVariable_A':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0];
    case 'statistik_A':
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];
    default:
      return [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
  }
}

/**
 * Compares the answer to an exercise with the facit.
 *
 * @param {Object} exercise
 * @returns {Boolean} True if facit and answer are the same, else false.
 */
const isCorrectAnswer = (exercise) => exercise.facit === exercise.questionAnswers;

/**
 * Will calculate a new user profile based on the exerciseProfiles
 *
 * @param {number[][]} exerciseProfiles A nested array of exercise profiles
 * @param {number[]} currentUserProfile The current user profile to be re-calculated
 * @returns {number[]} The re-calculated user profile
 */
function calculateUserProfile(exerciseProfiles, currentUserProfile) {
  const weightedUserProfile = scalarMultiplication(USER_WEIGHT, currentUserProfile);
  let newUserProfile = sumVectorArray(exerciseProfiles);

  newUserProfile = scalarMultiplication(1 / exerciseProfiles.length, newUserProfile);
  newUserProfile = sumVectorArray([newUserProfile, weightedUserProfile]);

  return newUserProfile;
}

/**
 * Will scale a vector with the given scalar and return the new scaled vector
 *
 * @param {number} scalar The scalar to use for the weight
 * @param {number[]} vector The vector to multiply with the scalar
 * @return {number[]} A new vector which is multiplied with the scalar
 */
const scalarMultiplication = (scalar, vector) => vector.map((x) => x * scalar);

/**
 * Will sum an array of vectors (arrays) together.
 * @param {number[][]} vectors
 * @return {number[]} Sum of vectors in the vectors array.
 */
const sumVectorArray = (vectors) => vectors.reduce((a, b) => a.map((c, i) => c + b[i]));

/**
 * Respondes to request with the newUserProfile.
 *
 * @param {number[]} newUserProfile
 * @param {{}} response
 */
function respondWithNewUserProfile(newUserProfile, response) {
  const newUserProfileJsonString = JSON.stringify(newUserProfile);
  response.writeHead(200, {
    'Content-Type': 'application/json',
  });
  response.end(newUserProfileJsonString);
}

module.exports = {
  handleReviseUserProfileRequest,
  handleReviseUserProfilePostRequest,
  reviseUserProfile,
  fetchRequestBody,
  requestBodyIsValid,
  requestBodyUserProfileIsValid,
  isUserProfileValidVector,
  requestBodyExerciseSetIsValid,
  validateEachExerciseInExerciseSet,
  convertExerciseSetToExerciseProfiles,
  calculateExerciseProfile,
  scalarMultiplication,
  convertExerciseToVector,
  isCorrectAnswer,
  sumVectorArray,
  respondWithNewUserProfile,
  calculateUserProfile,
  CORRECT_ANSWER_WEIGHT,
  WRONG_ANSWER_WEIGHT,
  USER_WEIGHT,
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Fri May 07 2021 11:36:06 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
